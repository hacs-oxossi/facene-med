<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#f9fafb" id="theme-color-meta" />
  <title>CÃ¡lculo de MÃ©dia Ponderada - MÃ³dulos AcadÃªmicos</title>
  <style>
    :root {
      --bg: #f9fafb;
      --fg: #111827;
      --primary: #2563eb;
      --primary-700: #1d4ed8;
      --card: #ffffff;
      --mod: #e0f2fe;
      --index: #dbeafe;
      --ok: #047857;
      --warn: #b45309;
    }
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: var(--bg);
      color: var(--fg);
      margin: 20px auto;
      max-width: 900px;
      padding: 0 10px;
      transition: background 0.3s ease, color 0.3s ease;
    }
    h1, h2, h3 { text-align: center; }
    .toggle-theme {
      display: flex;
      justify-content: center;
      margin-bottom: 15px;
    }
    .toggle-theme button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
    }
    .toggle-theme button:hover { background: var(--primary-700); }
    .indice { background: var(--index); padding: 10px; border-radius: 8px; margin-bottom: 20px; text-align: center; }
    .indice a { display: inline-block; color: var(--primary-700); text-decoration: none; margin: 5px 10px; }
    .modulo { background: var(--mod); border-radius: 10px; padding: 20px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
    .unidade { background: var(--card); border-radius: 8px; padding: 15px; margin-top: 12px; box-shadow: 0 1px 6px rgba(0,0,0,0.05); }
    label { display: flex; flex-direction: column; font-size: clamp(0.9rem, 2vw, 1rem); margin-bottom: 10px; }
    input { width: 100%; padding: 8px; margin-top: 4px; border-radius: 6px; border: 1px solid #cbd5e1; font-size: 1rem; }
    button.calc-btn { background-color: var(--primary); color: white; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; width: 100%; margin-top: 10px; font-size: 1rem; }
    button.calc-btn:hover { background-color: var(--primary-700); }
    .resultado { font-weight: bold; margin-top: 8px; color: var(--ok); text-align: center; }
    .mensagem { color: var(--warn); text-align: center; font-size: clamp(0.85rem, 2vw, 1rem); }

    /* Responsividade */
    @media (max-width: 768px) {
      body { margin: 10px; padding: 0 5px; }
      .modulo { padding: 15px; }
      .unidade { padding: 10px; }
      input, button.calc-btn { font-size: 0.95rem; }
      .indice a { display: block; margin: 6px 0; }
    }

    /* Modo escuro */
    body.dark {
      --bg: #0b1220;
      --fg: #e5e7eb;
      --primary: #3b82f6;
      --primary-700: #60a5fa;
      --card: #0f172a;
      --mod: #0b2540;
      --index: #0b2540;
      --ok: #34d399;
      --warn: #f59e0b;
    }
  </style>
</head>
<body>
  <h1>CÃ¡lculo de MÃ©dia Ponderada - MÃ³dulos AcadÃªmicos</h1>
  <div class="toggle-theme">
    <button id="theme-toggle">ðŸŒž Alternar Modo Claro/Escuro ðŸŒ™</button>
  </div>

  <div class="indice">
    <a href="#urgencia">UrgÃªncia e EmergÃªncia</a>
    <a href="#processos">Processos TerapÃªuticos I</a>
    <a href="#semiologia">Semiologia MÃ©dica I</a>
  </div>

  <div id="urgencia" class="modulo">
    <h2>Fundamentos da UrgÃªncia e EmergÃªncia</h2>
    <div class="unidade">
      <label>1Âª AvaliaÃ§Ã£o TeÃ³rica (Peso 9): <input type="number" id="fu_u1_av1" value="0" min="0" max="10" step="0.1"></label>
      <label>Teste de Progresso (Peso 1): <input type="number" class="teste-progresso" id="fu_u1_tp" value="0" min="0" max="10" step="0.1"></label>
    </div>
    <div class="unidade">
      <label>2Âª AvaliaÃ§Ã£o TeÃ³rica (Peso 1): <input type="number" id="fu_u2_av1" value="0" min="0" max="10" step="0.1"></label>
    </div>
    <div class="unidade">
      <label>3Âª AvaliaÃ§Ã£o OSPE (Peso 8): <input type="number" id="fu_u3_ospe" value="0" min="0" max="10" step="0.1"></label>
      <label>Atividades Processuais (Peso 2): <input type="number" id="fu_u3_proc" value="0" min="0" max="10" step="0.1"></label>
    </div>
    <div class="unidade">
      <label>4Âª AvaliaÃ§Ã£o Integrada (Peso 5): <input type="number" class="avaliacao-integrada" id="fu_u4_av1" value="0" min="0" max="10" step="0.1"></label>
      <label>Atividades Processuais (Peso 5): <input type="number" id="fu_u4_proc" value="0" min="0" max="10" step="0.1"></label>
    </div>
    <button class="calc-btn" onclick="calcular('urgencia')">Calcular mÃ©dia UrgÃªncia e EmergÃªncia</button>
    <div class="resultado" id="fu_final"></div>
    <div class="resultado mensagem" id="fu_mensagem"></div>
  </div>

  <script>
    function byId(id) { return document.getElementById(id); }

    function mediaPonderada(valoresPesos) {
      let somaPonderada = 0, somaPesos = 0;
      for (const vp of valoresPesos) {
        const v = Number(vp.valor);
        somaPonderada += v * vp.peso;
        somaPesos += vp.peso;
      }
      return somaPesos ? somaPonderada / somaPesos : 0;
    }

    function calcularModulo(prefix, nome, unidades) {
      const final = byId(prefix + '_final');
      const mensagem = byId(prefix + '_mensagem');
      const soma = unidades.reduce((a, b) => a + b, 0);
      const preenchidas = unidades.filter(u => !isNaN(u)).length;
      const mediaFinal = soma / 4;
      if (preenchidas < 4 || mediaFinal === 0) {
        const pontosNec = 7 * 4 - soma;
        const restam = 4 - preenchidas;
        final.innerText = '';
        mensagem.innerText = `MÃ©dia parcial: ${mediaFinal.toFixed(2)} | Faltam ${pontosNec.toFixed(2)} pontos para aprovaÃ§Ã£o. Ainda restam ${restam} unidade(s) a avaliar.`;
      } else {
        mensagem.innerText = '';
        final.innerText = `${nome}: ${mediaFinal.toFixed(2)}`;
      }
    }

    function calcular(modulo) {
      if (modulo === 'urgencia') {
        const fu_u1 = mediaPonderada([{valor:+fu_u1_av1.value, peso:9},{valor:+fu_u1_tp.value,peso:1}]);
        const fu_u2 = +fu_u2_av1.value;
        const fu_u3 = mediaPonderada([{valor:+fu_u3_ospe.value,peso:8},{valor:+fu_u3_proc.value,peso:2}]);
        const fu_u4 = mediaPonderada([{valor:+fu_u4_av1.value,peso:5},{valor:+fu_u4_proc.value,peso:5}]);
        calcularModulo('fu','MÃ©dia Final UrgÃªncia e EmergÃªncia',[fu_u1,fu_u2,fu_u3,fu_u4]);
      }
    }

    // SincronizaÃ§Ã£o de campos entre mÃ³dulos
    document.querySelectorAll('.avaliacao-integrada').forEach(el => {
      el.addEventListener('input', e => {
        const val = e.target.value;
        document.querySelectorAll('.avaliacao-integrada').forEach(i => i.value = val);
      });
    });

    document.querySelectorAll('.teste-progresso').forEach(el => {
      el.addEventListener('input', e => {
        const val = e.target.value;
        document.querySelectorAll('.teste-progresso').forEach(i => i.value = val);
      });
    });

    // AlternÃ¢ncia manual de modo claro/escuro
    const toggleButton = document.getElementById('theme-toggle');
    const metaTheme = document.getElementById('theme-color-meta');

    function applyTheme(dark) {
      if (dark) {
        document.body.classList.add('dark');
        metaTheme.setAttribute('content', '#0b1220');
        localStorage.setItem('theme', 'dark');
      } else {
        document.body.classList.remove('dark');
        metaTheme.setAttribute('content', '#f9fafb');
        localStorage.setItem('theme', 'light');
      }
    }

    // Detecta preferÃªncia do sistema e estado salvo
    const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) applyTheme(savedTheme === 'dark');
    else applyTheme(systemDark);

    toggleButton.addEventListener('click', () => {
      const dark = !document.body.classList.contains('dark');
      applyTheme(dark);
    });
  </script>
</body>
</html>
